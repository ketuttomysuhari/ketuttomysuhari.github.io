<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>VR â€” Dr. Ir. Ketut Tomy Suhari</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

    /* ===== DOM OVERLAY ROOT (this will be shown in VR if supported) ===== */
    #domOverlayRoot{
      position: fixed;
      inset: 0;
      display: none;           /* shown only when opened */
      background: rgba(0,0,0,.35);
      z-index: 99999;
    }

    /* Panel container */
    .panel{
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%);
      width: min(980px, 92vw);
      height: min(680px, 82vh);
      border-radius: 18px;
      overflow: hidden;
      background: rgba(10,16,30,.92);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      display: flex;
      flex-direction: column;
    }

    .panelHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 10px 12px;
      background: rgba(255,255,255,.06);
      border-bottom: 1px solid rgba(255,255,255,.10);
      color: #e8eefc;
    }

    .titleRow{
      display:flex; flex-direction:column; gap:2px;
    }
    .titleRow .t{ font-weight: 800; font-size: 14px; letter-spacing:.2px; }
    .titleRow .s{ font-weight: 600; font-size: 12px; opacity:.78; }

    .btns{ display:flex; gap:8px; flex-wrap:wrap; }
    .btn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #e8eefc;
      padding: 8px 10px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
    }
    .btn.primary{
      background: rgba(77,163,255,.20);
      border-color: rgba(77,163,255,.35);
    }
    .btn.danger{
      background: rgba(255,90,90,.18);
      border-color: rgba(255,90,90,.30);
    }

    .panelBody{
      flex:1;
      display:flex;
      background: rgba(0,0,0,.25);
    }

    /* Left sidebar inside panel */
    .side{
      width: 240px;
      border-right: 1px solid rgba(255,255,255,.10);
      padding: 10px;
      color: #e8eefc;
    }
    .side h4{
      margin: 4px 0 10px;
      font-size: 12px; opacity:.85;
      letter-spacing: .2px;
    }
    .navItem{
      width:100%;
      text-align:left;
      margin-bottom:8px;
      padding:10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color:#e8eefc;
      cursor:pointer;
      font-weight:800;
      font-size:12px;
    }
    .navItem small{ display:block; opacity:.72; font-weight:650; margin-top:2px; }

    /* Right content area */
    .content{
      flex:1;
      position: relative;
      background: rgba(255,255,255,.03);
    }

    /* iframe / embed fill */
    #webFrame, #pdfEmbed{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      border:0;
      display:none;
      background:#fff;
    }

    /* video area */
    #videoWrap{
      position:absolute;
      inset:0;
      display:none;
      padding: 12px;
      box-sizing: border-box;
    }
    #videoPlayer{
      width: 100%;
      height: 100%;
      border-radius: 14px;
      background: #000;
    }

    /* Fallback hint */
    #fallbackHint{
      position: fixed;
      left: 12px;
      bottom: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(10,16,30,.55);
      border: 1px solid rgba(255,255,255,.14);
      color: #e8eefc;
      font-size: 12px;
      z-index: 1000;
      max-width: 520px;
    }
  </style>
</head>

<body>
  <div id="fallbackHint">
    Tip: If DOM Overlay is not supported on your browser, portals will open in a new tab.
  </div>

  <!-- ===== DOM OVERLAY ROOT ===== -->
  <div id="domOverlayRoot" aria-hidden="true">
    <div class="panel" role="dialog" aria-modal="true">
      <div class="panelHeader">
        <div class="titleRow">
          <div class="t" id="panelTitle">Panel</div>
          <div class="s" id="panelSub">Scroll, open PDF, play video, and visit links.</div>
        </div>
        <div class="btns">
          <button class="btn" id="btnBack">Back</button>
          <button class="btn primary" id="btnOpenExternal">Open External</button>
          <button class="btn danger" id="btnClose">Close</button>
        </div>
      </div>

      <div class="panelBody">
        <div class="side">
          <h4>Quick items</h4>
          <button class="navItem" data-type="web" data-src="cv.html" data-title="CV (HTML)">
            CV (scroll)
            <small>Open cv.html inside the panel</small>
          </button>
          <button class="navItem" data-type="pdf" data-src="assets/cv/CV_KetutTomySuhari.pdf" data-title="CV (PDF)">
            CV PDF
            <small>Embedded PDF viewer</small>
          </button>
          <button class="navItem" data-type="video" data-src="assets/media/intro.mp4" data-title="Intro Video">
            Video
            <small>Play video inside panel</small>
          </button>
          <button class="navItem" data-type="web" data-src="projects.html" data-title="Projects">
            Projects
            <small>Open projects.html</small>
          </button>
          <button class="navItem" data-type="external" data-src="https://scholar.google.com/" data-title="External Website">
            External link
            <small>Open in new tab</small>
          </button>
        </div>

        <div class="content">
          <iframe id="webFrame" title="Web content"></iframe>
          <embed id="pdfEmbed" type="application/pdf" />
          <div id="videoWrap">
            <video id="videoPlayer" controls playsinline></video>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== A-Frame click navigation (portals) =====
    AFRAME.registerComponent('open-panel', {
      schema: {
        type: { type: 'string', default: 'web' }, // web | pdf | video | external
        src: { type: 'string', default: '' },
        title: { type: 'string', default: 'Panel' }
      },
      init: function () {
        this.el.addEventListener('click', () => {
          window.VRPanel.open(this.data);
        });
      }
    });

    // ===== DOM Overlay Panel Controller =====
    window.VRPanel = (function(){
      const root = document.getElementById('domOverlayRoot');
      const title = document.getElementById('panelTitle');
      const webFrame = document.getElementById('webFrame');
      const pdfEmbed = document.getElementById('pdfEmbed');
      const videoWrap = document.getElementById('videoWrap');
      const videoPlayer = document.getElementById('videoPlayer');

      const btnClose = document.getElementById('btnClose');
      const btnBack = document.getElementById('btnBack');
      const btnOpenExternal = document.getElementById('btnOpenExternal');

      let history = [];
      let current = null;

      function supportedDomOverlay(){
        // Heuristic: WebXR DOM Overlay support varies.
        // We still allow panel on non-VR (desktop) as normal overlay UI.
        return true;
      }

      function hideAll(){
        webFrame.style.display = 'none';
        pdfEmbed.style.display = 'none';
        videoWrap.style.display = 'none';
        // stop video when switching
        try { videoPlayer.pause(); videoPlayer.removeAttribute('src'); videoPlayer.load(); } catch(e){}
      }

      function setContent(cfg){
        current = cfg;
        title.textContent = cfg.title || 'Panel';
        hideAll();

        if (cfg.type === 'web') {
          webFrame.style.display = 'block';
          // NOTE: Cross-origin sites may block embedding via X-Frame-Options / CSP
          webFrame.src = cfg.src;
        } else if (cfg.type === 'pdf') {
          pdfEmbed.style.display = 'block';
          pdfEmbed.src = cfg.src;
        } else if (cfg.type === 'video') {
          videoWrap.style.display = 'block';
          videoPlayer.src = cfg.src;
          videoPlayer.play().catch(()=>{});
        } else if (cfg.type === 'external') {
          // best practice: open in new tab
          window.open(cfg.src, '_blank', 'noopener,noreferrer');
        }
      }

      function open(cfg){
        if (!supportedDomOverlay()) {
          // fallback: open as new tab
          window.open(cfg.src, '_blank', 'noopener,noreferrer');
          return;
        }

        if (cfg.type === 'external') {
          window.open(cfg.src, '_blank', 'noopener,noreferrer');
          return;
        }

        // push history
        if (current) history.push(current);

        root.style.display = 'block';
        root.setAttribute('aria-hidden', 'false');
        setContent(cfg);
      }

      function close(){
        root.style.display = 'none';
        root.setAttribute('aria-hidden', 'true');
        history = [];
        current = null;
        hideAll();
      }

      function back(){
        const prev = history.pop();
        if (!prev) return;
        setContent(prev);
      }

      function openExternal(){
        if (!current) return;
        const url = current.src || '';
        if (!url) return;
        window.open(url, '_blank', 'noopener,noreferrer');
      }

      // sidebar nav
      document.querySelectorAll('.navItem').forEach(btn=>{
        btn.addEventListener('click', () => {
          const cfg = {
            type: btn.dataset.type,
            src: btn.dataset.src,
            title: btn.dataset.title
          };
          if (cfg.type === 'external') {
            window.open(cfg.src, '_blank', 'noopener,noreferrer');
            return;
          }
          if (current) history.push(current);
          setContent(cfg);
        });
      });

      btnClose.addEventListener('click', close);
      btnBack.addEventListener('click', back);
      btnOpenExternal.addEventListener('click', openExternal);

      // Click outside panel to close (optional)
      root.addEventListener('click', (e)=>{
        if (e.target === root) close();
      });

      return { open, close, back };
    })();
  </script>

  <!-- =================== A-FRAME SCENE =================== -->
  <!-- Key point: dom-overlay="root:#domOverlayRoot" enables VR DOM overlay in compatible browsers -->
  <a-scene
    renderer="colorManagement: true"
    vr-mode-ui="enabled: true"
    webxr="optionalFeatures: dom-overlay"
    dom-overlay="root: #domOverlayRoot"
  >
    <a-assets>
      <img id="floorTex" src="https://cdn.aframe.io/a-painter/images/floor.jpg" crossorigin="anonymous" />
      <img id="skyTex" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg" crossorigin="anonymous" />
    </a-assets>

    <a-entity position="0 1.6 4">
      <a-camera>
        <a-cursor
          raycaster="objects: .clickable"
          fuse="false"
          material="color:#ffffff; shader:flat; opacity:0.9"
          geometry="primitive:ring; radiusInner:0.01; radiusOuter:0.016">
        </a-cursor>
      </a-camera>
    </a-entity>

    <a-sky src="#skyTex" rotation="0 -90 0"></a-sky>

    <a-plane position="0 0 0" rotation="-90 0 0" width="30" height="30"
      material="src:#floorTex; repeat:10 10; roughness:1; metalness:0">
    </a-plane>

    <a-entity position="0 2.2 0">
      <a-text value="VR Lobby" align="center" color="#E8EEFC" width="6"></a-text>
      <a-text value="Click a screen to open CV / PDF / Video / Web" align="center" color="#A9B6D3" position="0 -0.35 0" width="7"></a-text>
    </a-entity>

    <!-- ===== Laptop-like 3D screens (clickable) ===== -->

    <!-- CV (HTML) -->
    <a-entity position="-6 0 0">
      <a-box position="0 0.35 0.15" width="1.6" height="0.08" depth="1.1" material="color:#0b1220; opacity:0.95"></a-box>
      <a-box position="0 1.35 0" width="1.9" height="1.2" depth="0.06" material="color:#0b1220; opacity:0.95"></a-box>
      <a-plane class="clickable"
        open-panel="type: web; src: cv.html; title: CV (scroll)"
        position="0 1.35 0.035" width="1.75" height="1.05"
        material="color:#4da3ff; opacity:0.92; shader:flat">
      </a-plane>
      <a-text value="CV (scroll)" align="center" position="0 2.15 0" width="6" color="#E8EEFC"></a-text>
    </a-entity>

    <!-- CV PDF -->
    <a-entity position="-2 0 -6">
      <a-box position="0 0.35 0.15" width="1.6" height="0.08" depth="1.1" material="color:#0b1220; opacity:0.95"></a-box>
      <a-box position="0 1.35 0" width="1.9" height="1.2" depth="0.06" material="color:#0b1220; opacity:0.95"></a-box>
      <a-plane class="clickable"
        open-panel="type: pdf; src: assets/cv/CV_KetutTomySuhari.pdf; title: CV (PDF)"
        position="0 1.35 0.035" width="1.75" height="1.05"
        material="color:#6ee7b7; opacity:0.92; shader:flat">
      </a-plane>
      <a-text value="CV (PDF)" align="center" position="0 2.15 0" width="6" color="#E8EEFC"></a-text>
    </a-entity>

    <!-- Video -->
    <a-entity position="2 0 -6">
      <a-box position="0 0.35 0.15" width="1.6" height="0.08" depth="1.1" material="color:#0b1220; opacity:0.95"></a-box>
      <a-box position="0 1.35 0" width="1.9" height="1.2" depth="0.06" material="color:#0b1220; opacity:0.95"></a-box>
      <a-plane class="clickable"
        open-panel="type: video; src: assets/media/intro.mp4; title: Intro Video"
        position="0 1.35 0.035" width="1.75" height="1.05"
        material="color:#ffd166; opacity:0.92; shader:flat">
      </a-plane>
      <a-text value="Video" align="center" position="0 2.15 0" width="6" color="#04101f"></a-text>
    </a-entity>

    <!-- External website -->
    <a-entity position="6 0 0">
      <a-box position="0 0.35 0.15" width="1.6" height="0.08" depth="1.1" material="color:#0b1220; opacity:0.95"></a-box>
      <a-box position="0 1.35 0" width="1.9" height="1.2" depth="0.06" material="color:#0b1220; opacity:0.95"></a-box>
      <a-plane class="clickable"
        open-panel="type: external; src: https://scholar.google.com/; title: External"
        position="0 1.35 0.035" width="1.75" height="1.05"
        material="color:#b794f4; opacity:0.92; shader:flat">
      </a-plane>
      <a-text value="Open Website" align="center" position="0 2.15 0" width="6" color="#E8EEFC"></a-text>
    </a-entity>

    <a-entity light="type:ambient; intensity:0.7"></a-entity>
    <a-entity light="type:directional; intensity:0.9" position="3 6 2"></a-entity>
  </a-scene>
</body>
</html>
